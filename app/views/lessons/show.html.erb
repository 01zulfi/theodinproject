<%= title(@lesson.title) %>

<% if user_signed_in? && @lesson.has_submission? %>
  <div id="project-submission-modal-wrapper">
    <%= render 'projects/form_modal', lesson: @lesson, project: @project %>
  </div>
<% end %>

<% if @project&.persisted? %>
  <%= render 'projects/delete_modal', lesson: @lesson, project: @project %>
<% end %>

<div id="lesson-nav">
  <div class="inner-nav">
    <%= link_to "Course List", courses_path %> >>
    <%= link_to "#{@lesson.course.title}", course_path(@lesson.course.title_url) %> >>
    <%= link_to "#{@lesson.section.title}", course_path(@lesson.course.title_url, :anchor => "section-#{@lesson.section.title_url}") %> >>
    <% if @lesson.is_project %>
      Project:
    <% else %>
      <%= "#{@lesson.position_in_section}:" %>
    <% end %>
    <%= @lesson.title %>
  </div>
</div>

<div class="alert alert-info scroll-effect-alert">
  <strong>Scroll up</strong> or <strong>hover</strong> over the breadcrumbs to view the navigation bar
  <button type="button" class="close" data-dismiss="alert">&times;</button>
</div>

<!-- progress-tracking bar -->
<%= render 'shared/pt_bar', lesson: @lesson %>

<div class="individual-lesson <%= @lesson.is_project ? 'project-lesson' : ''%>">
  <div class="container">

    <% if user_signed_in? %>
      <h3 class="lc-completion-indicator <%= current_user.completed_lesson?(@lesson) ? '' : 'hidden' %>" title="You've completed this lesson!">
        &#10004;
      </h3>
    <% end %>

    <%= convert_markdown_to_html(@lesson.content) %>

    <% if @project&.new_record? %>
      <div id="new-submission">
        <%= render 'add_submission_button' %>
      </div>
    <% end %>

    <% if @submissions %>
      <div id="submissions">
        <%= render 'submissions', submissions: @submissions %>
      </div>
    <% end %>

    <%= render 'chat_link' %>

    <%= render 'right_box_ad', ad: @right_box_ad if @right_box_ad %>

    <%= render 'lower_banner_ad', ad: @lower_banner_ad if @lower_banner_ad %>

    <div id="info-box">
      <%= render 'shared/social_sharing_buttons' %>
      <%= render 'lessons/contribution_links' %>
      <%= render 'lessons/license' %>
      <div class="clearfix"></div>
    </div>

    <div class="action-box">
      <div class="lc-end-wrapper">
        <%= render 'shared/complete_lesson' %>
      </div>

      <div class="lnav">

        <div class="lnav-prev lnav-wrap <%= 'lnav-disabled' unless @lesson.prev_lesson %> ">
          <% if @lesson.prev_lesson %>
            <%= link_to course_lesson_path(@lesson.course, @lesson.prev_lesson, :ref => "lnav"), :title => "Go back to \"#{@lesson.prev_lesson.title}\""  do %>
              <div class="lnav-prev-icon icon"></div>
              <div class="lnav-text">
                <p>Prev</p><p>Lesson</p>
              </div>
            <% end %>
          <% else %>
            <div class="lnav-prev-icon icon"></div>
            <div class="lnav-text">
              <p>Previous</p><p>Lesson</p>
            </div>
          <% end %>
        </div>

        <div class="lnav-index lnav-wrap">
          <%= link_to course_path(@lesson.course.title_url, :ref => "lnav"), :title => "Go back to \"#{@lesson.course.title}\""  do %>
            <div class="lnav-course-icon icon <%= 'lnav-active' if user_signed_in? && current_user.completed_lesson?(@lesson) && @lesson.next_lesson.nil? %>"></div>
            <div class="lnav-text">
              <p>View</p><p>Course</p>
            </div>
          <% end %>
        </div>

        <div class="lnav-next lnav-wrap <%= 'lnav-disabled' unless @lesson.next_lesson %>">
          <% if @lesson.next_lesson %>
            <%= link_to course_lesson_path(@lesson.course, @lesson.next_lesson, :ref => "lnav"), :title => "Move on to \"#{@lesson.next_lesson.title}\"" do %>
              <div class="lnav-next-icon icon <%= 'lnav-active' if user_signed_in? && current_user.completed_lesson?(@lesson) && !@lesson.next_lesson.nil? %>"></div>
              <div class="lnav-text">
                <p>Next</p><p>Lesson</p>
              </div>
            <% end %>
          <% else %>
            <div class="lnav-next-icon icon"></div>
            <div class="lnav-text">
              <p>Next</p><p>Lesson</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<% content_for :stylesheets do %>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
<% end %>

<% content_for :scripts do %>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

  <script>
    // toastr options
    toastr.options = {
      "closeButton": true,
      "timeOut": "5000",
      "preventDuplicates": true
    };
  </script>
<% end %>

<script>
  $(function(){
    $(".individual-lesson a[href^='http://']").attr("target","_blank");
    $(".individual-lesson a[href^='https://']").attr("target","_blank");
  });

  // Invoke scroll effect, file lesson_header_onScroll.coffee
  window.lesson.applyScrollEffect([$('.navbar-fixed-top'), $('#lesson-nav')], { showOnHover: true });
</script>
