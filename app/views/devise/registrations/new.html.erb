<div id="devise-form" class="devise-sign-up gradient">

<!--

  We need to cover several special login/signup cases:
  * User is trying to create an account with Github and has now arrived at the step where he must check the legal agreements ... we need a "don't worry, this is the last step!" message
  * User already has an Odin account with that email and has tried to create an account / sign in with Github... we need a "if you've already created your account"

-->
  <div class="container">

    <!-- are we in an auth provider flow? -->
    <% auth_flow = !!@user.provider %>
    <% possible_duplicate_account = auth_flow && (@user.errors.has_key?(:username) || @user.errors.has_key?(:email)) %>

    <% if auth_flow %>
      <h1 class="text-center">Step 2: Verify Information</h1>
    <% else %>
      <h1 class="text-center">Sign up</h1>
    <% end %>
    <div class="card">
      <% if possible_duplicate_account %>
        <div class="signup-prompt-msg">
          <p>
            NOTE: If you're trying to link <%= @user.provider.titleize%> to an existing Odin Project account, please <%= link_to "login to your Odin Project account", login_path %> as normal and then follow the instructions on your Profile page for linking it with <%= @user.provider.titleize %>.
          </p>
        </div>
      <% elsif auth_flow %>
        <div class="signup-prompt-msg">
          <p>
            Please verify the information below, check off the legal agreements and click the <strong>Sign up</strong> button to finish creating your account
          </p>
        </div>
      <% end %>

      <%= simple_form_for(resource, :as => resource_name, :url => registration_path(resource_name), :html => { :class => "form-horizontal" } ) do |f| %>

        <%= f.error_notification unless auth_flow %>

        <div class="form-inputs">
          <div class="input-group">
            <span class="fa fa-envelope"></span>
            <%= f.input :username, label: false, required: true, placeholder: "Username", input_html: { class: "login user_username" } %>
          </div>
          <div class="input-group">
            <span class="fa fa-envelope"></span>
            <%= f.input :email, label: false, required: true, placeholder: "Email", input_html: { class: "login email" } %>
          </div>
          <% if f.object.password_required? %>
            <div class="input-group">
              <span class="fa fa-lock"></span>
              <%= f.input :password, :required => true, label: false, placeholder: "Password", input_html: { class: "login password" } %>
            </div>
            <div class="input-group">
              <span class="fa fa-lock"></span>
              <%= f.input :password_confirmation, :required => true, label: false, placeholder: "Password Confirmation", input_html: { class: "login password" }%>
            </div>
          <% end %>

          <!-- don't forget about our legal agreements checkbox! -->
          <%= render :partial => "devise/shared/legal_checkbox", :locals => {:f => f} %>

        </div>
        <!-- Check both cases of ternary operator -->
        <%= f.button :submit, "Sign up", :class => "sign-in-button page-buttons login #{auth_flow ? 'btn-sign-up-auth-flow' : 'btn-sign-up'}" %>

      <% end %>

      <div class="in-between text-center"><span>OR</span></div>
      
      <%= render :partial => "shared/github_button", :locals => {:button_type => "Sign up"} %>




      <%= render "devise/shared/links" %>
    </div>
    <h4 class="not-signed-up text-center">Have an account?</h4>
    <%= link_to "Login", new_session_path(resource_name), class: "sign-up-button text-center" %>
  </div>
</div>
